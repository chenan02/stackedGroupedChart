<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.w3.org/1999/xhtml
                      http://www.w3.org/MarkUp/SCHEMA/xhtml11.xsd">
<!-- airtightness.xhtml ================================================
Air tightness page for Comfort and Climate
Version    : $Id: airtightness.xhtml 2337 2012-09-20 15:14:54Z hartwig $
Application: Comfort and Climate
Platform   : XHTML 1.1
Description: The air tightness page shows the effect of air change.
========================================================================
Created    : 09.08.2012, Hartwig Thomas, Enter AG, Zurich
Copyright  : 2012, Baumschlager Eberle, Vaduz, Liechtenstein
==================================================================== -->
  <head>
    <title>Horizontal Bar Chart</title>
    <!-- Content type and character set -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <!-- Global style sheet -->

     <!-- <link rel="stylesheet" type="text/css" href="../../candc.css" /> -->
      <link rel="stylesheet" type="text/css" href="../../horizontalBarChart.css" />

    <!-- Constants declaration script -->
    <script type="text/javascript">
      //<![CDATA[
      var MESSAGES = {
        air_change_rate_numeric: "Air change rate must be entered as a number - possibly with a decimal point.",
        air_change_rate_positive: "Air change rate must be positive!",  
        saved: "Air change rate saved in the project.",
        not_saved: "Air change rate could not be saved in the project!\nPossibly an update collision occurred. Please try again.",
        system_error: "System error!"
      };
      //]]>
    </script>
	  <script>
		var dataArray = [
			{"Name": "Current", "Heating": 310504, "Humidification": 552339, "Cooling": 259034, "Dehumidification": 450818},
			{"Name": "1", "Heating": 52083, "Humidification": 85640, "Cooling": 42153, "Dehumidification": 74257},
			{"Name": "2", "Heating": 515910, "Humidification": 828669, "Cooling": 362642, "Dehumidification": 601943},
			{"Name": "3", "Heating": 202070, "Humidification": 343207, "Cooling": 157204, "Dehumidification": 264160},
			{"Name": "4", "Heating": 2704659, "Humidification": 4499890, "Cooling": 2159981, "Dehumidification": 3853788},
			{"Name": "5", "Heating": 358280, "Humidification": 587154, "Cooling": 261701, "Dehumidification": 466194},
			{"Name": "6", "Heating": 211637, "Humidification": 403658, "Cooling": 196918, "Dehumidification": 325110},
		];
	  </script>
      <script id="data" type="text/javascript">
          //<![CDATA[
          //set in setMessge in onlod in js file
          var sMessage = MESSAGES.not_saved;
          var sUserName = "Test User";
          var sProjectName = "Test Project";
          var iProjectGeneration = 2;
          var bExpired = false;
          var sFreePages = "climate, dimension, compactness, orientation, construction, windowsfront, windowsleft, windowsback, windowsright";
          //]]>
      </script>
      <!-- Global initialization script -->
    <script src="../../scripts/candc.js" type="text/javascript"></script>
  </head>
  <body>
    <div id="logo">
      <img src="../../images/logo.png" alt="Comfort and Climate Logo" />
    </div>
    <div id="nav">
      <p>Settings</p>
      <p class="indent"><a href="climate.xhtml">Climate</a> <img src="../../images/free.png"/></p>
      <p class="indent"><a href="dimension.xhtml">Dimension</a> <img src="../../images/free.png"/></p>
      <p><a href="compactness.xhtml">Compactness</a> <img src="../../images/free.png"/></p>
      <p><a href="orientation.xhtml">Orientation</a> <img src="../../images/free.png"/></p>
      <p><a href="construction.xhtml">Construction</a> <img src="../../images/free.png"/></p>
      <p>Windows</p>
      <p class="indent"><a href="windowsfront.xhtml">Front</a> <img src="../../images/free.png"/></p>
      <p class="indent"><a href="windowsleft.xhtml">Left</a> <img src="../../images/free.png"/></p>
      <p class="indent"><a href="windowsback.xhtml">Back</a> <img src="../../images/free.png"/></p>
      <p class="indent"><a href="windowsright.xhtml">Right</a> <img src="../../images/free.png"/></p>
      <p><a href="glazing.xhtml">Glazing</a> <img src="../../images/free.png"/></p>
      <p><a href="shading.xhtml">Shading</a> <img src="../../images/free.png"/></p>
      <p><a href="blinds.xhtml">Blinds</a> <img src="../../images/free.png"/></p>
      <p>Insulation</p>
      <p class="indent"><a href="roof.xhtml">Roof</a> <img src="../../images/free.png"/></p>
      <p class="indent"><a href="walls.xhtml">Walls</a> <img src="../../images/free.png"/></p>
      <p class="indent"><a href="floor.xhtml">Basement</a> <img src="../../images/free.png"/></p>
      <p class="selected"><a href="airtightness.xhtml">Air Tightness</a> <img src="../../images/free.png"/></p>
      <p><a href="occupancy.xhtml">Occupancy</a> <img src="../../images/free.png"/></p>
      <p>Results</p>
      <p class="indent"><a href="summary.xhtml">Summary</a> <img src="../../images/free.png"/></p>
      <p class="indent"><a href="comparison.xhtml">Comparison</a> <img src="../../images/free.png"/></p>
    </div>
    <div id="main">
      <div id="header">
        <table width="100%"><tr>
          <td width="32%"><p>Comfort and Climate - <strong>Horizontal Bar Chart</strong> <a href="http://info.comfortandclimate.com/?p=44" onclick="window.open(this.href,'_blank');return false;"><img src="../../images/info.png"/></a></p></td>
          <td width="33%"><p id="projectname">Project: </p></td>
          <td width="20%"><p id="username">User: </p></td>
          <td><p><a href="../preferences.xhtml">Preferences</a></p></td>
          <td><p><a href="../login.xhtml?logout=true">Log out</a></p></td>
        </tr></table>
        <hr/>
        <p id="message">Message<br/>Message</p>
      </div>
      <div id="content">
        <table id="diagrams">
          <tr>
            <td>
              <!-- monthly energy demand and temperature  -->
                <div id="stackedGroupedChart"></div>
            </td>
          </tr>
        </table>
      </div>
      <div id="footer">
        <table width="100%"><tr>
          <td width="30%"><p><a href="http://www.baumschlager-eberle.com/" onclick="window.open(this.href,'_blank');return false;">Baumschlager Eberle</a></p></td>
          <td width="30%"><p><a id="termsandconditions" href="http://info.comfortandclimate.com/?p=54" onclick="window.open(this.href,'_blank');return false;">Terms and Conditions</a></p></td>
          <td width="30%"><p><a id="contact" href="http://info.comfortandclimate.com/?p=59" onclick="window.open(this.href,'_blank');return false;">Contact</a></p></td>
          <td><p><a href="../about.xhtml" onclick="window.open(this.href,'_blank');return false;">Credits</a></p></td>
        </tr></table>
      </div>
      <div id="validate">
        <a href="http://validator.w3.org/check?uri=referer"><img src="http://www.w3.org/Icons/valid-xhtml11" alt="Valid XHTML 1.1" height="31" width="88" /></a>
      </div>
    </div>    
  </body>
  <script src="../../scripts/d3.v3.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script>
var margin = {top: 20, right: 20, bottom: 30, left: 40},
    width = 960 - margin.left - margin.right,
    height = 500 - margin.top - margin.bottom;
 
var x0 = d3.scale.ordinal()
    .rangeRoundBands([0, width], 0.1);
 
var x1 = d3.scale.ordinal();
 
var y = d3.scale.linear()
    .range([height, 0]);
 
var xAxis = d3.svg.axis()
    .scale(x0)
    .orient("bottom");
 
var yAxis = d3.svg.axis()
    .scale(y)
    .orient("left")
    .tickFormat(d3.format(".2s"));
 
var color = d3.scale.ordinal()
    .range(["#BA202A", "#DE8585", "#0080C8", "#95C9FC"]);
 
var svg = d3.select("#stackedGroupedChart").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
 
var yBegin;
 
var innerColumns = {
  "column1" : ["Heating","Humidification"],
  "column2" : ["Cooling", "Dehumidification"]
}
 
d3.csv("data.csv", function(error, data) {
  var columnHeaders = d3.keys(data[0]).filter(function(key) { return key !== "State"; });
  color.domain(d3.keys(data[0]).filter(function(key) { return key !== "State"; }));
  data.forEach(function(d) {
    var yColumn = new Array();
    d.columnDetails = columnHeaders.map(function(name) {
      for (ic in innerColumns) {
        if($.inArray(name, innerColumns[ic]) >= 0){
          if (!yColumn[ic]){
            yColumn[ic] = 0;
          }
          yBegin = yColumn[ic];
          yColumn[ic] += +d[name];
          return {name: name, column: ic, yBegin: yBegin, yEnd: +d[name] + yBegin,};
        }
      }
    });
    d.total = d3.max(d.columnDetails, function(d) { 
      return d.yEnd; 
    });
  });
 
  x0.domain(data.map(function(d) { return d.State; }));
  x1.domain(d3.keys(innerColumns)).rangeRoundBands([0, x0.rangeBand()]);
 
  y.domain([0, d3.max(data, function(d) { 
    return d.total; 
  })]);
 
  svg.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);
 
  svg.append("g")
      .attr("class", "y axis")
      .call(yAxis)
    .append("text")
      .attr("transform", "rotate(-90)")
      .attr("y", 6)
      .attr("dy", ".7em")
      .style("text-anchor", "end")
      .text("");
 
  var project_stackedbar = svg.selectAll(".project_stackedbar")
      .data(data)
    .enter().append("g")
      .attr("class", "g")
      .attr("transform", function(d) { return "translate(" + x0(d.State) + ",0)"; });
 
  project_stackedbar.selectAll("rect")
      .data(function(d) { return d.columnDetails; })
    .enter().append("rect")
      .attr("width", x1.rangeBand())
      .attr("x", function(d) { 
        return x1(d.column);
         })
      .attr("y", function(d) { 
        return y(d.yEnd); 
      })
      .attr("height", function(d) { 
        return y(d.yBegin) - y(d.yEnd); 
      })
      .style("fill", function(d) { return color(d.name); });
 
  var legend = svg.selectAll(".legend")
      .data(columnHeaders.slice().reverse())
    .enter().append("g")
      .attr("class", "legend")
      .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });
 
  legend.append("rect")
      .attr("x", width - 18)
      .attr("width", 18)
      .attr("height", 18)
      .style("fill", color);
 
  legend.append("text")
      .attr("x", width - 24)
      .attr("y", 9)
      .attr("dy", ".35em")
      .style("text-anchor", "end")
      .text(function(d) { return d; });
 
});
 
</script>
</html>